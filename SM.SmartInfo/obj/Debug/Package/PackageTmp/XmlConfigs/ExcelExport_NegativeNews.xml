<?xml version="1.0" encoding="utf-8" ?>
<report xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <save_as_file_name>Báo cáo xử lý thông tin bất lợi</save_as_file_name>
  <templates>
    <template file_name="ExcelExport_NegativeNews.xlsx" paper_size="A4" is_default="true" />
  </templates>
  <render_infos>
    <!--Data tĩnh-->
    <render_info>
      <source_dynamic>
        <![CDATA[
select
	Name as TenVuViec
	, FORMAT(IncurredDTG , 'HH:mm - dd/MM/yyyy') as ThoiGianPhatSinh
from News where NewsID = @NewsID and Deleted = 0
				]]>
      </source_dynamic>
      <set_defined_name>true</set_defined_name>
      <active_sheet>Data</active_sheet>
    </render_info>

    <render_info>
      <source_dynamic>
        <![CDATA[
select
	row_number() over(order by news.NegativeNewsID desc) as STT
	, FORMAT(news.IncurredDTG , 'HH:mm - dd/MM/yyyy') as ThoiGian
	, pa.Name as KenhDangTai
	, news.Judged as DanhGia
	, news.MethodHandle as CachXuLy
	, news.Result as KetQua
	, '' as GhiChu
from NegativeNews news
left join agency_PressAgency pa on pa.PressAgencyID = news.PressAgencyID and pa.Deleted = 0
where news.NewsID = @NewsID and news.Deleted = 0 and news.Type = 2

union all

select top 1
	null as STT
	, null as ThoiGian
	, N'Tổng hợp' as KenhDangTai
	, null as DanhGia
	, null as CachXuLy
	, null as KetQua
	, N'Hiện có ' + cast(count(case when news.PressAgencyID is not null and (news.OtherChannel is null or news.OtherChannel = 0) then 1 else null end) as nvarchar(256)) 
	+ N' báo đưa tin và ' + cast(count(case when news.OtherChannel is not null and news.OtherChannel = 1 and news.PressAgencyID is null then 1 else null end) as nvarchar(256)) + N' tin trên mạng xã hội' as GhiChu
from NegativeNews news
where news.NewsID = @NewsID and news.Deleted = 0 and news.Type = 2
				]]>
      </source_dynamic>
      <virtual_table>
        <template_row_name>STT</template_row_name>
      </virtual_table>
    </render_info>
  </render_infos>
</report>