<?xml version="1.0" encoding="utf-8" ?>
<report xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema">
  <save_as_file_name>Báo cáo tuyến tin bài</save_as_file_name>
  <templates>
    <template file_name="ExcelExport_News.xlsx" paper_size="A4" is_default="true" />
  </templates>
  <render_infos>
    <!--Data tĩnh-->
    <render_info>
      <source_dynamic>
        <![CDATA[
select
  cast(sum(isnull(NumberOfNews, 0)) as nvarchar(256)) + N' lượt bài đăng, trong đó:' as TongSoBaiPR
from CampaignNews where NewsID = @NewsID and Deleted = 0
				]]>
      </source_dynamic>
      <set_defined_name>true</set_defined_name>
      <active_sheet>Data</active_sheet>
    </render_info>

    <!--Data tĩnh-->
    <render_info>
      <source_dynamic>
        <![CDATA[
select
  Content as DanhGiaChiTiet,
  N'Từ ' + Convert(varchar, PostingFromDTG, 103) + N' - Đến ' + Convert(varchar, PostingToDTG, 103) as ThoiGianDangTin
from News where NewsID = @NewsID and Deleted = 0
				]]>
      </source_dynamic>
      <set_defined_name>true</set_defined_name>
      <active_sheet>Data</active_sheet>
    </render_info>

    <render_info>
      <source_dynamic>
        <![CDATA[
select
	cast(row_number() over(order by NewsID asc) as nvarchar(256)) + N'. Tuyến bài "' + Campaign + '": ' + cast(isnull(NumberOfNews, 0) as nvarchar(256)) + N' bài' as TenTuyenBai
from CampaignNews where NewsID = @NewsID and Deleted = 0
				]]>
      </source_dynamic>
      <virtual_table>
        <template_row_name>TenTuyenBai</template_row_name>
      </virtual_table>
      <active_sheet>Data</active_sheet>
    </render_info>

    <render_info>
      <source_dynamic>
        <![CDATA[
select
	isnull(campNews.Campaign, '') as Group0
	, case posNews.Type
	when 1 then N'Truyền hình'
	when 2 then N'Báo mạng'
	when 3 then N'Báo giấy'
	when 4 then N'Mạng xã hội'
	when 5 then N'Diễn đàn'
  else ''
	end as Group1
	, case posNews.Type
	when 1 then N'Truyền hình'
	when 2 then N'Báo mạng'
	when 3 then N'Báo giấy'
	when 4 then N'Mạng xã hội'
	when 5 then N'Diễn đàn'
  else ''
	end as PhuongTien
	, pa.Name as KenhTruyenThong
	, Convert(varchar, posNews.PublishDTG, 103) as NgayPhatHanh
	, posNews.Title as TieuDe
	, posNews.Brief as TomTat
	, N'PR' as HinhThuc
	, N'Tích cực' as PhanLoaiTin
	, posNews.Url as Link
from PositiveNews posNews
left join CampaignNews campNews on campNews.CampaignNewsID = posNews.CampaignID and campNews.Deleted = 0
left join agency_PressAgency pa on pa.PressAgencyID = posNews.PressAgencryID and pa.Deleted = 0
where posNews.NewsID = @NewsID and posNews.Deleted = 0
				]]>
      </source_dynamic>
      <virtual_table_group>
        <GroupDefinedName>AUTO_GROUP_</GroupDefinedName>
        <group_columns>
          <string>Group0</string>
          <string>Group1</string>
        </group_columns>
      </virtual_table_group>
    </render_info>
  </render_infos>
</report>